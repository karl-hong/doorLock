# doorLock

## 1.硬件配置

- RS485引脚
    - RTS: PA12
    - CTS: PA11
    - TX: PA9
    - RX: PA10
- 电机驱动
    - A: PB12
    - B: PB11
    - C: PB10
    - D: PB2
- Gsensor
    - SDA: PF7
    - SCL: PF6
- 灯条控制
    - L1: PB4，高有效
    - L2: PB3，高有效
- 钥匙检测
    - KEY: PB8
- 门磁检测
    - DOOR1: PB15
    - DOOR2: PB14
- 锁状态检测
    - LOCK1: PB6
    - LOCK2: PB7
- 指示灯
    - RED: PB1，低有效
    - GREEN: PB0，低有效
- debug口
    - RX: PA3
    - TX: PA2

## 2.协议

### （1）单锁状态查询指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 锁状态 + 门磁1状态 + 门磁2状态 + 钥匙反馈开关状态 + 关锁延时 + 是否开启关锁延时 + 灯1状态 + 灯2状态 + 报警状态 + 是否开启上报 + UID + 校验码 + 帧尾

### （2）批量开关锁指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 开关锁 + 校验码 + 帧尾
> - 应答帧：无

### （3）单锁开关锁指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 开关锁 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 开关锁 + UID + 校验码 + 帧尾

### （4）批量基础设置指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 关锁延时 + 关锁延时启动标志 + 主动上报启动标志 + 校验码 + 帧尾
> - 应答帧：无

### （5）单锁基础设置指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 关锁延时 + 关锁延时启动标志 + 主动上报启动标志 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 关锁延时 + 关锁延时启动标志 + 主动上报启动标志 + UID + 校验码 + 帧尾

### （6）批量灯带设置指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 灯带开关 + 校验码 + 帧尾
> - 应答帧：无

### （7）单灯带开关设置指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 灯带1开关设置 + 灯带2开关设置 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 灯带1开关设置 + 灯带2开关设置 + UID + 校验码 + 帧尾

### （8）批量清除报警状态指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 校验码 + 帧尾
> - 应答帧：无

### （9）单锁清除报警状态指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 报警状态 + UID + 校验码 + 帧尾

### （10）单锁手动开关上报指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 报警类型 + UID + 校验码 + 帧尾
> - 应答帧：无

### （11）延时自动关锁上报指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 地址 + UID + 校验码 + 帧尾
> - 应答帧：无

### （12）单锁开关锁异常上报指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 报警类型 + UID + 校验码 + 帧尾
> - 应答帧：无

### （13）单锁振动查询指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + x轴数据 + y轴数据 + z轴数据 + UID + 校验码 + 帧尾

### (14) 单锁查询所有状态指令
> - 请求帧：帧头 + 指令 + 操作码 + 长度 + UID + 校验码 + 帧尾
> - 应答帧：帧头 + 指令 + 操作码 + 长度 + 地址 + 锁状态 + 门磁1状态 + 门磁2状态 + 钥匙反馈开关状态 + 关锁延时 + 是否开启关锁延时 + 灯1状态 + 灯2状态 + 报警状态 + 是否开启上报 +  x轴数据 + y轴数据 + z轴数据 + UID + 校验码 + 帧尾

## 3. 协议示例

### （1）单锁状态查询
> - 请求帧：AA D0 00 00 0C 00 53 00 3D 56 43 57 13 20 31 34 35 1C 67 55
> - 应答帧：AA D1 00 00 19 00 01 00 00 01 1E 00 00 00 00 00 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 B7 4B 55 

### （2）批量开关锁指令
> - 请求帧（开）：AA D0 01 00 01 00 72 67 55
> - 请求帧（关）：AA D0 01 00 01 01 62 46 55
> - 应答帧：无

### （3）单锁开关锁指令
> - 请求帧（开）：AA D0 02 00 0D 00 00 53 00 3D 56 43 57 13 20 31 34 35 0E 08 55
> - 应答帧（开）: AA D1 02 00 0E 00 00 00 53 00 3D 56 43 57 13 20 31 34 35 7B 67 55
> - 请求帧（关）：AA D0 02 00 0D 01 00 53 00 3D 56 43 57 13 20 31 34 35 4B 6B 55
> - 应答帧（关）：AA D1 02 00 0E 00 01 00 53 00 3D 56 43 57 13 20 31 34 35 3E 04 55

### （4）批量基础设置指令
> - 请求帧（10秒）：AA D0 03 00 05 00 00 0A 01 01 DC 30 55
> - 应答帧：无

### （5）单锁基础设置指令
> - 请求帧：AA D0 04 00 12 01 1E 00 00 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 A9 DD 55
> - 应答帧：AA D1 04 00 12 01 1E 00 00 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 C4 05 55 

### （6）批量灯带设置指令
> - 请求帧（开）：AA D0 05 00 01 01 A8 B7 55
> - 请求帧（关）：AA D0 05 00 01 00 B8 96 55

### （7）单灯带开关设置指令
> - 请求帧（开）：AA D0 06 00 0E 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 F6 DC 55
> - 应答帧（开）：AA D1 06 00 0F 01 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 E1 3C 55 
> - 请求帧（关）：AA D0 06 00 0E 00 00 00 53 00 3D 56 43 57 13 20 31 34 35 C8 DE 55
> - 应答帧（关）：AA D1 06 00 0F 01 00 00 00 53 00 3D 56 43 57 13 20 31 34 35 DF 3E 55

### （8）批量清除报警状态指令
> - 请求帧：AA D0 07 00 00 2D 93 55
> - 应答帧：无

### （9）单锁清除报警状态指令
> - 请求帧：AA D0 08 00 0C 00 53 00 3D 56 43 57 13 20 31 34 35 3B 22 55
> - 应答帧：AA D1 08 00 0E 01 00 00 53 00 3D 56 43 57 13 20 31 34 35 A6 D2 55 

### （10）单锁手动开关上报指令
> - 请求帧（开）：AA D0 09 00 0E 01 00 00 53 00 3D 56 43 57 13 20 31 34 35 46 01 55 
> - 请求帧（关）：AA D0 09 00 0E 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 03 62 55

### （11）延时自动开关锁上报指令
> - 请求帧：AA D0 0A 00 0D 01 00 53 00 3D 56 43 57 13 20 31 34 35 5A EE 55 
> - 应答帧：无

### （12）单锁开关锁异常上报指令
> - 请求帧：AA D0 0B 00 0E 01 01 00 53 00 3D 56 43 57 13 20 31 34 35 22 A6 55 
> - 应答帧：无

### （13）单锁振动查询指令
> - 请求帧：AA D0 0C 00 0C 00 53 00 3D 56 43 57 13 20 31 34 35 A0 90 55
> - 应答帧：AA D1 0C 00 13 01 00 70 FF ED 03 D9 00 53 00 3D 56 43 57 13 20 31 34 35 A9 8C 55 

### （14）单锁查询所有状态指令
> - 请求帧：AA D0 0D 00 0C 00 53 00 3D 56 43 57 13 20 31 34 35 0E 6C 55
> - 应答帧：
